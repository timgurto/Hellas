<meta http-equiv="refresh" content="0.5" >
<html>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

<head>
    <link href="style.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <h1>Hellas server</h1>

    <h2>Stats</h2>
    <p><span class="heading"> Version:</span> <span id="version" class="data" /></p>
    <p><span class="heading"> Uptime:</span> <span id="time" class="data" /></p>
    
    <h2>Users</h2>
    <table id="users" >
    <tr>
        <td class="heading">Username</td>
        <td class="heading">City</td>
        <td class="heading">Location</td>
    </tr>
    </table>
</body>

<script type="text/javascript" src="stats.js"></script>
<script type="text/javascript">
    function make2Digits(n){
        return ("0" + n).slice(-2)
    }

    function timeDisplay(ms){
        var s = Math.round(ms/1000);
        var m = Math.floor(s/60); s = s % 60;
        var h = Math.floor(m/60); m = m % 60;
        var d = Math.floor(h/24); h = h % 24;
        
        var formattedTime = "";
        if (d != 0)
            formattedTime += d + ":";
        if (d != 0 || h != 0)
            formattedTime += make2Digits(h) + ":";
        if (d != 0 || h != 0 || m != 0)
            formattedTime += make2Digits(m) + ":";
        formattedTime += make2Digits(s);
        
        return  formattedTime;
    }
    
    function makeUserRow(user){
        var cells = "";
        cells += "<td>" + user.name + "</td>";
        
        var cityText = user.city;
        if (user.isKing)
            cityText = cityText + " <span class='king'>&#x265B;</span>";
        cells += "<td>" + cityText + "</td>";
        
        cells += "<td>" + Math.round(user.x) + ", " + Math.round(user.y) + "</td>";
        
        return cells;
    }

    $("#version").html(stats.version);
    $("#time").html(timeDisplay(stats.time));
    
    for (var i = 0; i < stats.users.length; ++i)
        //$("#users").append('<tr><td>' + stats.users[i] + '</td></tr>');
        $("#users").append("<tr>" + makeUserRow(stats.users[i]) + "</tr>");
        
</script>

</html>
